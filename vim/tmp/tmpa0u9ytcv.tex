% Input your problem and solution below.
% Three dashes on a newline indicate the breaking points.

---

Let $P$ be the set of all primes, and let $M$ be a nonempty subset of $P$. Suppose that for any nonempty subset $\{p_1,p_2,\ldots,p_k\}$ of $M$, all prime factors of $p_1p_2\cdots p_k+1$ are also in $M$. Prove that $M=P$.

---

Fix a prime $p\notin M$, and consider $S_p\subseteq\mathbb F_p$ the set of residues modulo $p$ that appear infinitely often in $M$. Let $T_p\subseteq M$ the elements of $M$ equivalent to some element of $S_p$ modulo $p$. Therefore, $M\setminus T_p$ is finite, so let the product of its elements be $N$.

Let $a_0=1$; then given that $a_n$ is the product of some distinct elements of $T_p$, we can write
\[Na_n+1=p_1^{e_1}\cdots p_k^{e_k}\]
for $p_1,\ldots,p_k\in T_p$ (since $\gcd(N,p_i)=1$.)

Replace each $p_i^{e_i}$ with $e_i$ distinct elements of $T_p$, each equivalent to $p_i$ modulo $p$, which exist by definition of $T_p$; then let the resulting product be $a_{n+1}$. It follows that $a_{n+1}\equiv Na_n+1\pmod p$, and $a_{n+1}$ is the product of distinct elements of $T_p$.

Thus this sequence may be extended infinitely. But note that
\begin{itemize}
    \item if $N\equiv1\pmod p$, then some element of $a_1$, $a_2$, $\ldots$ will be $0\pmod p$;
    \item otherwise, 
        \[a_{p-2}\equiv N^{p-2}+N^{p-3}+\cdots+1\equiv\frac{N^{p-1}-1}{N-1}\equiv0\pmod p.\]
\end{itemize}
Both cases yield contradiction.

