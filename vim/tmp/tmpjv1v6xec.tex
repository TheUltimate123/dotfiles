% Input your problem and solution below.
% Three dashes on a newline indicate the breaking points.
% vim: tw=72

---

Find all functions $f:\mathbb R\to\mathbb R$ such that for all real numbers $x$ and $y$, \[(f(x)+xy)\cdot f(x-3y)+(f(y)+xy)\cdot f(3x-y)=(f(x+y))^2.\]

---

The answer is $f\equiv0$ and $f(x)=x^2$.  Let $P(x,y)$ denote the assertion.
\setcounter{iclaim}0
\begin{iclaim}
    $f(0)=0$.
\end{iclaim}
\begin{proof}
    $P(0,0)$ gives $2f(0)^2=f(0)^2$, and thus $f(0)=0$.
\end{proof}
\begin{iclaim}
    $f$ is even.
\end{iclaim}
\begin{proof}
    $P(0,y)$ gives $f(y)f(-y)=f(y)^2$ and $P(0,-y)$ gives $f(y)f(-y)=f(-y)^2$. If $f(y)=0$, then $f(-y)=0$ and the claim is true. Otherwise $f(-y)=f(y)$, as desired.
\end{proof}
\begin{iclaim}
    For all $x$, either $f(4x)=0$ or $f(x)=x^2$.
\end{iclaim}
\begin{proof}
    $P(x,-x)$ gives $f(4x)\left[f(x)+f(-x)-2x^2\right]=0$. But recall that $f(x)=f(-x)$, so if $f(4x)\ne0$, then $f(x)=x^2$.
\end{proof}
\begin{iclaim}
    $f(x)=0\iff f(2x)=0$. In particular, $f(x)=0$ or $f(x)=x^2$ for all $x$.
\end{iclaim}
\begin{proof}
    Suppose $x\ne0$. $P(x,x)$ gives $2\left(f(x)+x^2\right)f(2x)=f(2x)^2$. If $f(x)=0$ but $f(2x)\ne0$, then $8x^4=16x^4$, which is absurd If $f(2x)=0$, then $P(\tfrac34x,\tfrac14x)$ gives \[f(x)^2=f(2x)\left(f\left(\frac x4\right)+\frac{3x^2}{16}\right)=0,\]
    as desired. Thus $f(x)=x^2\iff f(4x)\ne0\iff f(x)\ne0$.
\end{proof}
\begin{iclaim}
    If there exists $a\ne0$ with $f(a)=0$, then $f\equiv0$.
\end{iclaim}
\begin{proof}
    Note that $f(x)\ge0$ for all $x$, and furthermore by Claim 2 we can assume $a>0$. If $z>0$, $P(\tfrac12a,-\tfrac12z)$ gives \[0\le f\left(\frac{a-z}2\right)^2=\left(f\left(\frac a2\right)-\frac{az}2\right)f(z)=-\frac{az}2f(z).\]
    But $-\tfrac12az<0$, so $f(z)=0$, and by Claim 2 $f\equiv0$, as desired.
\end{proof}

It is easy to check that $f\equiv0$ and $f(x)=x^2$ work, so we are done.
