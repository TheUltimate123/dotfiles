% Input your problem and solution below.
% Three dashes on a newline indicate the breaking points.

---

The numbers $1$, $\ldots$, $n^2$ are placed in some order in an $n\times n$ grid, such that each number appears exactly once. Let $R_i$ be the largest element in the $i$th row and $C_i$ the smallest element in the $i$th column. Find the maximum possible value of $\sum_{i=1}^n(R_i-C_i)$.

---

The answer is $\frac16n(n-1)(2n+5)$. Label the rows $1$, $\ldots$, $n$ and the columns $n+1$, $\ldots$, $2n$. Say that we have a tournament with the players $1$, $\ldots$, $2n$, such that the first $n$ players from a team, and the last $n$ players form an opposing team. The $2n$ players play all the players on the other team in a period of $n^2$ days, such that each day contains exactly one game, and the order the games are played are determined by the coordinates of each of the squares the integers $1$ through $n^2$ are placed in.

The players $1$ through $n$ initially stay at a premium hotel, and stay until they have played all their games. The players $n+1$ through $2n$ arrive on the day of their first game, and stay until the end of the tournament. The game manager, who we shall call Evan, pays one coin per person at the hotel every day of the tournament. If we add a constant of $n(n^2+1)$ to our desired sum, we want to minimize the total number of coins Evan must pay.

Let $C(p,q)$, with $p\le n$ and $q>n$, be the total number of players at the hotel when $p$ and $q$ play their match. Arrange the players such that the players $1$ through $n$ leave in that order, and the players $n+1$ through $2n$ arrive in that order.
\begin{iclaim*}
    If $C(p,q)\le k$ for some $k\ge n$, then either $p,q\le k$ or $p,q>2n-k$.
\end{iclaim*}
\begin{proof}
    We prove the contrapositive. Clearly players $i$, for $p\le i\le q$, must be at the hotel. Note that if any player $i$, $i\le p$, has left the hotel, then he has played all other players, so players $p$ through $2n$ must be at the hotel.

    Hence if players $1$, $\ldots$, $p$ ad not all at the hotel, then players $p$, $\ldots$, $2n$ are at the hotel. Then if $q>k$, the first scenario yields $C(p,q)>k$, and if $p\le 2n-k$, the second scenario yields $C(p,q)>k$. Thus the claim has been proven.
\end{proof}

It is now clear that the minimum possible value of $C(p,q)$ is the smallest integer $k$ such that $p,q\le k$ or $p,q>2n-k$. We can verify that in this optimal scenario, the number of days with cost at most $k\ge n$ is given by $f(k)=n^2-(2n-k)^2$. After some computation, we deduce that
\begin{align*}
    \sum_{i=1}^n\sum_{j=n+1}^{2n}C(i,j)&\ge\sum_{k=n+1}^{2n}k(f(k)-f(k-1))\\
    &=2nf(2n)-(n+1)f(n)-\sum_{k=n+1}^{2n-1}f(k)\\
    &=2n^3-(n-1)n^2+\frac{n(n-1)(2n-1)}6\\
    &=\frac16n\left(8n^2+3n+1\right).
\end{align*}
Subtracting off the constant $n(n^2+1)$, we obtain the lower bound $\frac16n(n-1)(2n+5)$. To achieve equality, consider the following construction:
\begin{itemize}
    \item For the first $\frac12n(n+1)$ days, for $i=1$ through $k$, player $n+i$ arrives at the hotel and plays players $i$ through $n-i+1$.
    \item For the next $\frac12n(n-1)$ days, from $i=1$ through $k$, player $i$ plays players $2n-j$ for $j=0$ through $i=2$, then departs from the hotel.
\end{itemize}
It is not hard to see that equality holds for this construction, so we are done.

