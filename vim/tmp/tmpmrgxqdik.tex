% Input your problem and solution below.
% Three dashes on a newline indicate the breaking points.

---

In a $999\times999$ square table some cells are white and the remaining ones are red. Let $T$ be the number of triples $(C_1,C_2,C_3)$ of cells, the first two in the same row and the last two in the same column, with $C_1$, $C_3$ white and $C_2$ red. Find the maximum value $T$ can attain.

---

Let $n=333$. For $3n\times3n$ grids, the answer is $12n^2$.
\begin{lemma*}
    $x^2(3n-x)\le4n^3$, with equality at $x=2n$.
\end{lemma*}
\begin{proof}
    By AM-GM,
    \[\sqrt[3]{\frac{x^2(3n-x)}4}\le\frac{\frac12x+\frac12x+(3n-x)}3=n.\]
\end{proof}

Let $a_i$ be the number of white squares in each row, and $b_j$ the number of white squares in each column.  Then
\begin{align*}
    T^2&=\left(\sum_{(i,j)\text{ red}}a_ib_j\right)^2
    \le\left(\sum_{(i,j)\text{ red}}a_i^2\right)\left(\sum_{(i,j)\text{ red}}b_j^2\right)\\
    &\le\left[\sum_{i=1}^{3n}a_i^2(3n-a_i)\right]\cdot\left[\sum_{j=1}^{3n}b_j^2(3n-b_j)\right]
    \le\left(\sum_{i=1}^{3n}4n^3\right)^2=\left(12n^4\right)^2.
\end{align*}
Hence $T\le12n^4$. Equality holds by having three $n\times n$ red squares along the main diagonal.

