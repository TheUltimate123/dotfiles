% Input your problem and solution below.
% Three dashes on a newline indicate the breaking points.

---

Let $ABC$ be a triangle with circumcenter $O$ and orthocenter $H$. Point $P$ is the reflection of $A$ with respect to $\seg{OH}$. Assume that $P$ is not on the same side of $\seg{BC}$ as $A$. Points $E$ and $F$ lie on $\seg{AB}$ and $\seg{AC}$ respectively such that $BE=PC$ and $CF=PB$. Let $K$ be the intersection of $\seg{AP}$ and $\seg{OH}$. Prove that $\angle EKF=90^\circ$.

---

\begin{center}
    \begin{asy}
        size(9.5cm); defaultpen(fontsize(10pt));
        pen pri=heavyblue;
        pen sec=purple;
        pen tri=red;
        pen qua=fuchsia;
        pen fil=pri+opacity(0.05);
        pen sfil=sec+opacity(0.05);
        pen tfil=tri+opacity(0.05);
        pen qfil=qua+opacity(0.05);

        pair O,A,B,C,H,P,D,EE,F,K,M,Y,NN;
        O=(0,0);
        A=dir(115);
        B=dir(215);
        C=dir(325);
        H=A+B+C;
        P=reflect(O,H)*A;
        D=B+C-P;
        EE=intersectionpoint(A--B,circle(B,length(C-P)));
        F=intersectionpoint(A--C,circle(C,length(B-P)));
        K=(A+P)/2;
        M=(B+C)/2;
        Y=2*foot(O,P,D)-P;
        NN=(EE+F)/2;

        filldraw(circumcircle(A,EE,F),qfil,qua);
        draw(Y--P,qua);
        filldraw(circumcircle(K,EE,F),tfil,tri);
        draw(EE--F,tri);
        filldraw(circumcircle(D,K,P),sfil,sec);
        filldraw(B--P--C--D--cycle,sfil,sec);
        draw(M--NN,sec+dashed);
        draw(A--P,sec);
        filldraw(circumcircle(B,H,C),fil,pri);
        filldraw(circle(O,1),fil,pri);
        draw( (5H-4O)--(5O-4H),pri);
        real t=1.28;
        clip( (-t,-t)--(-t,100)--(t,100)--(t,-t)--cycle);
        draw(A--B--C--A,pri);

        dot("$O$",O,dir(250));
        dot("$A$",A,N);
        dot("$B$",B,W);
        dot("$C$",C,E);
        dot("$H$",H,S);
        dot("$P$",P,SE);
        dot("$D$",D,dir(285));
        dot("$E$",EE,dir(120));
        dot("$F$",F,dir(30));
        dot("$K$",K,dir(75));
        dot("$M$",M,S);
        dot("$Y$",Y,SW);
        dot("$N$",NN,NW);
    \end{asy}
\end{center}
Let $M$ be the midpoint of $\seg{BC}$, $N$ the midpoint o $\seg{EF}$, $D$ the point such that $BPCD$ is a parallelogram, and $Y$ the second intersection of $\seg{PMD}$ with $(ABC)$.
\setcounter{iclaim}0
\begin{iclaim}
    $D$ lies on $\seg{OH}$.
\end{iclaim}
\begin{proof}
    By reflection through $M$, $D$ lies on $(BHC)$. Thus \[\da BHD=\da BCD=\da CBP=\da CAP=90\dg+\da(\seg{AC}+\seg{OH})=\da BHO,\]
    as desired.
\end{proof}
\begin{iclaim}
    $\angle EDF=90\dg$.
\end{iclaim}
\begin{proof}
    Since $BE=PC=BD$ and $CF=PB=CD$,
    \begin{align*}
        \da EDF&=\da EDB+\da BDC+\da CDF=\da BED+\da CPB+\da DFC\\
        &=\da AED+\da FAE+\da DFA=\da FDE.
    \end{align*}
    Since $D\notin\seg{EF}$, it follows that $\angle EDF=90\dg$.
\end{proof}
\begin{iclaim}
    $Y$ is the Miquel point of $BCFE$; in particular, $Y\in(AEF)$.
\end{iclaim}
\begin{proof}
    Since $M\in\seg{YP}$, we have \[\frac{YB}{YC}=\frac{PC}{PB}=\frac{BE}{CF},\]
    whence $\triangle YBE\sim\triangle YCF$, as desired.
\end{proof}
\begin{iclaim}
    $\seg{MN}\perp\seg{OH}$.
\end{iclaim}
\begin{proof}
    A spiral similarity at $Y$ sends $\seg{BC}\cup M$ to $\seg{EF}\cup N$, so \[\da YMN=\da YBE=\da YBA=\da YPA=\da(\seg{YM},\seg{AP}),\]
    it follows that $\seg{MN}\parallel\seg{AP}$, which is sufficient.
\end{proof}

Finally since $\angle DKP=90\dg$, $M$ is the center of $(DKP)$, whence $D$ and $K$ are reflections across $\seg{MN}$. It follows that $K\in(DEF)$, so $\angle BKC=\angle BDC=90\dg$, and we are done.

