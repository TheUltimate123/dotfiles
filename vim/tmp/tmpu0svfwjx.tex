% Input your problem and solution below.
% Three dashes on a newline indicate the breaking points.

---

Find all functions $f:\mathbb N\to\mathbb N$ such that for all positive integers $m$ and $n$, $f(m)+2mn+f(n)$ is a perfect square.

---

The answer is $f(n)=n^2+4kn+2k^2$ for some nonnegative integer $k$.
\begin{iclaim*}
    For all $m$, $f(m+2)=2f(m+1)-f(m)+2$.
\end{iclaim*}
\begin{proof}
    Take an arbitrary integer $n$. By the problem statement there are integers $a$, $b$, $c$ with
    \begin{align*}
        a^2&=f(m)+2mn+f(n),\\
        b^2&=f(m+1)+2mn+2n+f(n),\\
        c^2&=f(m+2)+2mn+4n+f(n).
    \end{align*}
    Then I claim that we can select $n$ such that
    \begin{itemize}[itemsep=0em]
        \item $c>b$,
        \item $p=f(m+1)-f(m)+2n$ is prime, and
        \item $2n>f(m+2)-3f(m+1)+2f(m)-6$.
    \end{itemize}
    For the first condition, we will show $f(m+2)>f(m+1)$ always. Assume for contradiction otherwise, and consider $c^2-b^2=f(m+2)-f(m+1)+2n$. If $f(m+2)-f(m+1)\le0$, we can choose $n$ such that $c^2-b^2\in\{1,2\}$, both of which are absurd. For the second condition, $f(m+1)-f(m)+2n$ is the difference between two squares, no matter the choice of $n$, but if this quantity is always even, then it is at some point $2\pmod4$, which is impossible. Finally the third condition is possible since we can take $n$ sufficiently large.

    Subtracting the definitions of $a^2$ and $b^2$, we have $p=b^2-a^2$, whence $a=\tfrac12(p-1)$ and $b=\tfrac12(p+1)$. Now I claim that $c=\tfrac12(p+3)$. Assume for contradiction otherwise.

    Since $c>b$, we must have $c\ge\tfrac12(p+5)$. This rearranges to
    \begin{align*}
        \left(\frac{p+5}2\right)^2&=f(m+2)-f(m+1)+2n+\left(\frac{p+1}2\right)^2\\
        \implies2(p+3)&\le f(m+2)-f(m+1)+2n\\
        \implies 2n&\le f(m+2)-3f(m+1)+2f(m)-6,
    \end{align*}
    which violates the third condition.

    Now \[f(m+2)-f(m+1)=\left(\frac{p+3}2\right)^2-\left(\frac{p+1}2\right)^2-2n=f(m+1)-f(m)+2,\]
    as desired.
\end{proof}

Hence $f$ is a monic quadratic, so let $f(n)=n^2+un+v$. Assuming $m=n$ in the problem statement, we have $4n^2+2un+2v$ is always a perfect square. With $n$ sufficiently large, we must have \[4n^2+2un+2v=\left(2n+\frac u4\right)^2,\]
It follows that $u=4k$ and $v=2k^2$ for some $k$, so we are done.

