% Input your problem and solution below.
% Three dashes on a newline indicate the breaking points.

---

\begin{center}
    \begin{asy}
        size(12cm);
        defaultpen(fontsize(9pt));

        pen pri=deepblue;
        pen sec=royalblue;
        pen tri=blue;
        pen qua=Cyan;
        pen qui=deepcyan;
        pen fil=pri+opacity(0.05);
        pen sfil=sec+opacity(0.05);
        pen tfil=tri+opacity(0.05);
        pen qfil=qua+opacity(0.05);
        pen qifil=qui+opacity(0.05);

        pair O, T, B, C, Bp, Cp, I, K, Kp, H, Hp, M, NN, X, Y, P, Q, O1, O2, J, Kq, Hq;
        O=(0, 0); T=(1.7, 0);
        B=intersectionpoints(circle(O, 1), circle(T/2, length(T)/2))[0];
        C=intersectionpoints(circle(O, 1), circle(T/2, length(T)/2))[1];
        Bp=-B; Cp=-C;
        I=incenter(O, B, C);
        K=(2B+7T)/9;
        Kp=extension(C, I, K, foot(K, B, C));
        H=extension(Kp, Cp, T, C);
        Hp=extension(B, I, H, foot(H, B, C));
        M=dir(270);
        NN=dir(90);
        X=foot(K, B, C);
        Y=foot(H, B, C);
        P=foot(B, Bp, K);
        Q=foot(C, Cp, H);
        O1=extension(O, P, K, K+O-B);
        O2=extension(O, Q, H, H+O-C);
        J=intersectionpoint(O1 -- O2, circle(O1, length(K-O1)));
        Kq=extension(K, J, H, Hp);
        Hq=extension(H, J, K, Kp);

        filldraw(circle(O, 1), fil, pri);
        filldraw(circumcircle(B, X, P), sfil, sec);
        filldraw(circumcircle(C, Y, Q), sfil, sec);
        filldraw(circumcircle(P, X, Y), sfil, sec);
        filldraw(circumcircle(B, Y, P), tfil, tri);
        filldraw(circumcircle(C, X, Q), tfil, tri);
        filldraw(circle(O1, length(K-O1)), qfil, qua);
        filldraw(circle(O2, length(H-O2)), qfil, qua);
        filldraw(circumcircle(B, K, Q), qifil, qui);
        filldraw(circumcircle(C, H, P), qifil, qui);
        draw(K -- Bp, tri);
        draw(H -- Cp, tri);
        draw(B -- Bp, pri);
        draw(C -- Cp, pri);
        draw(B -- T -- C -- B, pri);
        draw(K -- Kp, pri);
        draw(H -- Hp, pri);
        draw(B -- M, sec);
        draw(C -- NN, sec);
        draw(M -- P -- Cp, qua);
        draw(NN -- Q -- Bp, qua);
        draw(B -- Kq -- K, qui);
        draw(C -- Hq -- H, qui);

        dot("$O$", O, W);
        dot("$T$", T, E);
        dot("$B$", B, N);
        dot("$C$", C, S);
        dot("$B'$", Bp, Bp);
        dot("$C'$", Cp, Cp);
        dot("$I$", I, W);
        dot("$K$", K, dir(10));
        dot("$H$", H, dir(-10));
        dot("$K'$", Kp, dir(160));
        dot("$H'$", Hp, dir(120));
        dot("$M$", M, M);
        dot("$N$", NN, NN);
        dot("$X$", X, NE);
        dot("$Y$", Y, SE);
        dot("$P$", P, SE);
        dot("$Q$", Q, dir(12));
        dot("$J$", J, unit(O1-O2));
        dot("$K^+$", Kq, dir(260));
        dot("$H^+$", Hq, N);
    \end{asy}
\end{center}
\begin{customsol}{to part (a)}
    Ignore the collinearities for now. Let $\overline{B'K}$ and $\overline{C'H}$ intersect $\omega$ again at $P$ and $Q$, and let $\overline{BC}$ intersect $\overline{KK'}$ at $X$ and $\overline{HH'}$ at $Y$. Denote by $M$ and $N$ the midpoints of arcs $CB'$ and $BC'$, so that $H'\in\overline{BM}$ and $K'\in\overline{CN}$.
    \setcounter{iclaim}0
    \begin{iclaim}
        Points $Q$, $Y$, $B'$ are collinear; points $P$, $X$, $C'$ are collinear; and $XPQY$ is cyclic.
    \end{iclaim}
    \begin{proof}
        Since $\measuredangle CQY=\measuredangle CHY=90^{\circ}-\measuredangle YCH=\measuredangle OCB=\measuredangle CBB'=\measuredangle CQB'$, points $Q$, $Y$, $B'$ are collinear. Analogously $P$, $X$, $C'$ are collinear. Finally the concyclicity follows from the converse of Reim's Theorem. To spell it out, $\measuredangle PXY=\measuredangle PC'B'=\measuredangle PQB'=\measuredangle PQY$.
    \end{proof}
    \begin{iclaim}
        Points $H$, $K'$, $C'$ are collinear if and only if points $Q$, $X$, $N$ are collinear. Symmetrically, points $K$, $H'$, $B'$ are collinear if and only if points $P$, $Y$, $M$ are collinear.
    \end{iclaim}
    \begin{proof}
        Check that $\measuredangle K'QX=\measuredangle K'CX=\measuredangle NCB=\measuredangle C'QN$, so \[\overline{HK'C'}\iff\measuredangle C'QX=\measuredangle K'QX\iff\measuredangle C'QX=\measuredangle C'QN\iff\overline{QXN},\]
        where $\overline{UVW}$ is the assertion that $U$, $V$, $W$ are collinear.
    \end{proof}
    \begin{iclaim}
        Points $Q$, $X$, $N$ are collinear if and only if points $P$, $Y$, $M$ are collinear.
    \end{iclaim}
    \begin{proof}
        Assume that $Q$, $X$, $N$ are collinear. It follows that $\measuredangle C'PY=\measuredangle XPY=\measuredangle XQY=\measuredangle NQB'=\measuredangle C'QN$, proving the claim.
    \end{proof}

    Putting these claims together yields the desired conclusion.
\end{customsol}
\begin{customsol}{to part (b)}
    First we present a well-known lemma.
    \begin{boxlemma*}[Folklore]
        Circles $\Gamma_1$ and $\Gamma_2$ are externally tangent at $P$, circles $\Gamma_2$ and $\Gamma_3$ are externally tangent at $Q$, and circles $\Gamma_3$ and $\Gamma_1$ are externally tangent at $R$. Let $A$ be an arbitrary point on $\Gamma_1$. Line $AP$ intersects $\Gamma_2$ again at $B$, line $BQ$ intersects $\Gamma_3$ again at $C$, and line $\overline{CR}$ intersects $\Gamma_1$ again at $D$. Then $\overline{AD}$ is a diameter of $\Gamma_1$.
    \end{boxlemma*}
    \begin{proof}
        Let $O_1$, $O_2$, $O_3$ be the centers of $\Gamma_1$, $\Gamma_2$, $\Gamma_3$, respectively. Since $D$ must be the insimilicenter of $\Gamma_1$ and $\Gamma_2$, rays $O_1A$ and $O_2B$ are parallel but in opposite directions. Similarly rays $O_2B$ and $O_3C$ are opposite and parallel, and so are rays $O_3C$ and $O_1D$.

        Combining these, $\overline{O_1A}$ and $\overline{O_1D}$ are parallel but in opposite directions; in other words, $\overline{AD}$ must be a diameter of $\Gamma_1$, as claimed.
    \end{proof}

    For now, ignore the two extra circles. We prove another concyclicity.
    \begin{iclaim}
        $BKQIK'$ and $CHPIH'$ are cyclic.
    \end{iclaim}
    \begin{proof}
        Since $\measuredangle BKK'=90^{\circ}-\measuredangle XBK=90^{\circ}-\measuredangle CC'B=\measuredangle BCC'=\measuredangle BQK'$, quadrilateral $BKQK'$ is cyclic. Furthermore $\measuredangle BIK'=\measuredangle BIN=\measuredangle BON=\measuredangle BQC'=\measuredangle BQK'$, as desired.
    \end{proof}
    \begin{iclaim}
        $(JPK)$ and $\omega$ are tangent at $P$. Analogously $(JQH)$ and $\omega$ are tangent at $Q$.
    \end{iclaim}
    \begin{proof}
        The tangent to $(JPK)$ at $K$ is $\overline{BT}$, which is parallel to the tangent to $\omega$ at $B'$. Thus by homothety, the tangency point between $(JPK)$ and $\omega$ lies on $\overline{KB'}$ and therefore must be $P$. The other case follows in a similar fashion.
    \end{proof}

    Let $(JPK)$ intersect $\overline{KK'}$ again at $H^+$ and let $(JQH)$ intersect $\overline{HH'}$ again at $K^+$.
    \begin{iclaim}
        $J$ lies on $\overline{KK^+}$ and $\overline{HH^+}$.
    \end{iclaim}
    \begin{proof}
        Angle chasing, $\measuredangle KJH^+=\measuredangle BKH^+=90^{\circ}-\measuredangle CBT$, and similarly $\measuredangle K^+JH=90^{\circ}-\measuredangle TCB$. These are equal, so $\measuredangle KJH^+=\measuredangle K^+JH$. Since $\overline{KH^+}\parallel\overline{HK^+}$, we must have that $J=\overline{KK^+}\cap\overline{HH^+}$.
    \end{proof}

    By the lemma applied to $(JPK)$, $(JQH)$, $\omega$, we find that the second intersection of $\overline{QK^+}$ and $\omega$ must be the antipode of $B'$; id est it is $B$. It follows that $B$, $Q$, $K^+$ are collinear, and by symmetry so are $C$, $P$, $H^+$.

    To finish, remark that $\measuredangle BQJ=\measuredangle K^+QJ=\measuredangle JPK=\measuredangle BKJ$. Symmetry implies that $BKJQIK'$ and $CHJPKH'$ are cyclic, so we are done.
\end{customsol}
\newpage

\begin{boxprob}[Iran TST 2011/6a]
    Let $BCB'C'$ be a rectangle inscribed in the circle $\omega$ with center $O$. Points $K$ and $H$ lie on the tangents to $\omega$ at $B$ and $C$, respectively, and points $K'$ and $H'$ lie on the angle bisectors of $\angle BCO$ and $\angle CBO$, respectively, such that $\overline{KK'}$ and $\overline{HH'}$ are perpendicular to $\overline{BC}$. Prove that $K$, $H'$, $B'$ are collinear if and only if $H$, $K'$, $C'$ are collinear.
\end{boxprob}
\begin{center}
    \begin{asy}
        size(9.5cm);
        defaultpen(fontsize(9pt));

        pen pri=deepblue;
        pen sec=royalblue;
        pen tri=blue;
        pen qua=Cyan;
        pen qui=deepcyan;
        pen fil=pri+opacity(0.05);
        pen sfil=sec+opacity(0.05);
        pen tfil=tri+opacity(0.05);
        pen qfil=qua+opacity(0.05);
        pen qifil=qui+opacity(0.05);

        pair O, T, B, C, Bp, Cp, I, K, Kp, H, Hp, M, NN, X, Y, P, Q, O1, O2, J, Kq, Hq;
        O=(0, 0); T=(0, 1.7);
        B=intersectionpoints(circle(O, 1), circle(T/2, length(T)/2))[1];
        C=intersectionpoints(circle(O, 1), circle(T/2, length(T)/2))[0];
        Bp=-B; Cp=-C;
        I=incenter(O, B, C);
        K=(2B+7T)/9;
        Kp=extension(C, I, K, foot(K, B, C));
        H=extension(Kp, Cp, T, C);
        Hp=extension(B, I, H, foot(H, B, C));
        M=dir(0);
        NN=dir(180);
        X=foot(K, B, C);
        Y=foot(H, B, C);
        P=foot(B, Bp, K);
        Q=foot(C, Cp, H);
        O1=extension(O, P, K, K+O-B);
        O2=extension(O, Q, H, H+O-C);
        J=intersectionpoint(O1 -- O2, circle(O1, length(K-O1)));
        Kq=extension(K, J, H, Hp);
        Hq=extension(H, J, K, Kp);

        filldraw(circle(O, 1), fil, pri);
        filldraw(circumcircle(B, X, P), sfil, sec);
        filldraw(circumcircle(C, Y, Q), sfil, sec);
        filldraw(circumcircle(P, X, Y), sfil, sec);
        filldraw(circumcircle(B, Y, P), tfil, tri);
        filldraw(circumcircle(C, X, Q), tfil, tri);
        draw(K -- Bp, tri);
        draw(H -- Cp, tri);
        draw(B -- Bp, pri);
        draw(C -- Cp, pri);
        draw(B -- T -- C -- B, pri);
        draw(K -- Kp, pri);
        draw(H -- Hp, pri);
        draw(B -- M, sec);
        draw(C -- NN, sec);
        draw(M -- P -- Cp, qua);
        draw(NN -- Q -- Bp, qua);

        dot("$O$", O, S);
        dot("$T$", T, N);
        dot("$B$", B, dir(190));
        dot("$C$", C, dir(-10));
        dot("$B'$", Bp, Bp);
        dot("$C'$", Cp, Cp);
        dot("$I$", I, S);
        dot("$K$", K, dir(95));
        dot("$H$", H, dir(80));
        dot("$K'$", Kp, dir(155));
        dot("$H'$", Hp, dir(210));
        dot("$M$", M, M);
        dot("$N$", NN, NN);
        dot("$X$", X, NW);
        dot("$Y$", Y, NE);
        dot("$P$", P, dir(60));
        dot("$Q$", Q, dir(102));
    \end{asy}
\end{center}
\begin{customenv}{First solution, by angle chasing}
    Ignore the collinearities for now. Let $\overline{B'K}$ and $\overline{C'H}$ intersect $\omega$ again at $P$ and $Q$, and let $\overline{BC}$ intersect $\overline{KK'}$ at $X$ and $\overline{HH'}$ at $Y$. Denote by $M$ and $N$ the midpoints of arcs $CB'$ and $BC'$, so that $H'\in\overline{BM}$ and $K'\in\overline{CN}$.
    \setcounter{iclaim}0
    \begin{iclaim}
        Points $Q$, $Y$, $B'$ are collinear; points $P$, $X$, $C'$ are collinear; and $XPQY$ is cyclic.
    \end{iclaim}
    \begin{proof}
        Since $\measuredangle CQY=\measuredangle CHY=90^{\circ}-\measuredangle YCH=\measuredangle OCB=\measuredangle CBB'=\measuredangle CQB'$, points $Q$, $Y$, $B'$ are collinear. Analogously $P$, $X$, $C'$ are collinear. Finally the concyclicity follows from the converse of Reim's Theorem. To spell it out, $\measuredangle PXY=\measuredangle PC'B'=\measuredangle PQB'=\measuredangle PQY$.
    \end{proof}
    \begin{iclaim}
        Points $H$, $K'$, $C'$ are collinear if and only if points $Q$, $X$, $N$ are collinear. Symmetrically, points $K$, $H'$, $B'$ are collinear if and only if points $P$, $Y$, $M$ are collinear.
    \end{iclaim}
    \begin{proof}
        Check that $\measuredangle K'QX=\measuredangle K'CX=\measuredangle NCB=\measuredangle C'QN$, so \[\overline{HK'C'}\iff\measuredangle C'QX=\measuredangle K'QX\iff\measuredangle C'QX=\measuredangle C'QN\iff\overline{QXN},\]
        where $\overline{UVW}$ is the assertion that $U$, $V$, $W$ are collinear.
    \end{proof}
    \begin{iclaim}
        Points $Q$, $X$, $N$ are collinear if and only if points $P$, $Y$, $M$ are collinear.
    \end{iclaim}
    \begin{proof}
        Assume that $Q$, $X$, $N$ are collinear. It follows that $\measuredangle C'PY=\measuredangle XPY=\measuredangle XQY=\measuredangle NQB'=\measuredangle C'QN$, proving the claim.
    \end{proof}

    Putting these claims together yields the desired conclusion.
\end{customenv}
\begin{customenv}{Second solution, by moving points}
    Let $M$ and $N$ be the midpoints of arcs $CB'$ and $BC'$ respectively. Choose a point $K$ on $\overline{BT}$; we construct $K'$ on $\overline{CN}$ with $\overline{KK'}\perp\overline{BC}$, let $H=\overline{CT}\cap\overline{C'K'}$, construct $H'$ on $\overline{BM}$ with $\overline{HH'}\perp\overline{BC}$, and let $K_0=\overline{BT}\cap\overline{B'H'}$. Our task is to prove that $K=K_0$.

    Move $K$ along line $BT$ at a linear rate, and let $\infty_{\perp BC}$ be the point at infinity perpendicular to $\overline{BC}$.
    \begin{itemize}[itemsep=0em]
        \item By projection through $\infty_{\perp BC}$, $K'$ moves along $\overline{CN}$ at a linear rate.
        \item By projection through $C'$, $H$ moves along $\overline{CT}$ at a linear rate.
        \item By projection through $\infty_{\perp BC}$, $H'$ moves along $\overline{BM}$ at a linear rate.
        \item By projection through $B'$, $K_0$ moves along $\overline{BT}$ at a linear rate.
    \end{itemize}
    Thus it suffices to verify the hypothesis for three values of $K$. We verify the following special cases:
    \begin{itemize}[itemsep=0em]
        \item $K=B$: Then $K'$ lies on $\overline{BC}$, to $H$ is the reflection of $C$ over $T$. Then $H'=B$, so $K_0=B$.
        \item $K$ is the reflection of $B$ over $T$: Then $K'=C$, so $H=C$ and $H'$ is a point on $\overline{CB'}$. Thus $K_0=K$.
        \item $K$ is the point at infinity along $\overline{TB}$: Then $K'$ is the point at infinity along $\overline{CN}$, so $H=\overline{TC}\cap\overline{MC'}$. Then since $H'$ lies on $\overline{BM}$, it is the reflection of $H$ over $\overline{MN}$, so $\overline{B'H'}$ is tangent to $\omega$. It follows that $K_0=K$.
    \end{itemize}
    This completes the proof.
\end{customenv}

